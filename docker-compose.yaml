services:
  hytale:
    build:
      context: .
      dockerfile: Dockerfile
    image: hytale-server:local
    ports:
      - "5520:5520/udp"
    container_name: hytale-server
    # Image runs a dedicated non-root user (`hytale`); do not override the runtime user here to avoid permission mismatches.
    env_file: .env
    working_dir: /hytale
    read_only: true
    tmpfs:
      - /tmp:size=64m,mode=1777,exec
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges:true
    # Bind-mount (writable) for server files
    volumes:
      - "serverfiles:/hytale:rw"
    restart: unless-stopped

# Usage notes:
# - Set SERVERFILESPATH to an absolute path on the host (eg: /home/user/hytale-data) before running
#   to control where server files are persisted.
# - If you need host UID/GID mapping, you can set PUID/PGID in `.env`, but avoid overriding the container user unless you handle permissions intentionally.

volumes:
  serverfiles:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${SERVERFILESPATH}
